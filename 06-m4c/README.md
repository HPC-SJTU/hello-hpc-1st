# 神秘流程题 - 魔咒筛选器 m4c (map for charms)

魔咒商店上线啦！我们提供了一个魔咒服务器, 它提供了很多组、每组很多条魔咒。

一个魔咒是一串二进制代码，它满足

- 包括魔咒内容和价格 （layout: 内容 bytes 和价格拼接而成）
- 内容长度在 [32, 16384] 之内
- 价格应等于魔咒内容的按 byte 异或之和
- 魔咒按价格分为 256 组
- 魔咒按 base64 编码（不带 padding）的后连续相同字符数确定等级

魔咒服务器的 HTTP API 接口如下：

- `GET /`: 返回一个列表 (JSON)，列表长度即为组数，每组提供 `len` 条魔咒；例如 `[114,514]`代表有两组魔咒，分别提供 `114` 和 `514` 条魔咒。
- `GET /:group/:id`: 返回一个二进制魔咒；`group` 为组号 $\in[0, \operatorname{len}(groups))$, `id` 为魔咒号 $\in[0, \operatorname{len}(group))$

我们已提供了服务器可执行文件 `server`，要求处理流程如下：

1. 下载这些算例
2. 按照价格 （checksum）分类
3. 筛选：“合法”；checksum (xor of byte) 正确
4. 去重：同价格内，一条魔咒与已去重的魔咒相比，长度不相同，或是后 16B 不一致，或是不同字符 > 3，视为不重复；去重顺序按照魔咒号顺序进行
5. 统计魔咒等级：base64 后尾部有 N 位字符连续相同，则等级为 N；N 最大为 16；要从 0-16 计数魔咒等级
6. 校验正确性：对所有魔咒内容（不包括价格）的按顺序（见代码）拼接计算哈希 SHA1

`source_code` 文件夹提供了示例文件和 server 可执行文件。请修改或编写程序，启动服务器，并输出最终哈希（小写 hex 格式）。

提示：

- 提供的 baseline 可能会执行很久，可以加入一行 `groups = groups[:1]` 在第一组上优化并验证正确性后再拓展到所有组
- 评测时使用的数据与发布的 server 数据量与性质大致相同，请尽情优化❤
- Python 在本题中似乎性能不佳，可以考虑用 C++ 重写 ~~(Rewrite it in Rust.png)~~
- 关于提交文件：
  - 请使用 `evaluate.py` 测试通过后再打包提交
  - 建议使用提供的 `submit.py` 打包，同时检查打包的文件是否符合预期
  - 可使用任何编程语言重写，但需要在 `build` 程序中从源码编译
  - 提交文件不应包含编译产物（建议通过 .gitignore 文件排除）
  - 若有依赖库请在 writeup.md 里说明下载地址和使用目的，且打包到提交文件中；评测环境不可联网
- 如遇本地 `evaluate.py` 运行正确、平台评测错误的情况
  - 请对照原版的 build 和 start 脚本检查，确定没有遗漏编译和启动，尤其是启动服务器本体
  - 请注意打包相关依赖，评测环境不会提供超算默认环境之外的任何库；做题过程中建议记录所有环境变量和全局库的改动，防止遗漏

## 评分标准

你需要打包 zip 文件在 OJ 上提交。本题需要提供的文件包括

- `source_code` 文件夹，包括：
  - `build`: 可执行文件，在程序正式启动前运行，用于环境部署和编译，此时不提供 `server` 文件，不纳入计时
  - `start`: 可执行文件，启动 `server`、运行处理流程并输出最终哈希，纳入计时
  - 任何其他源代码文件，但不包括提供的 server
- `writeup.md`: 你的做题思路

你可以通过运行 `submit.py` 自动打包 `submit.zip`。

评测会在 `source_code` 目录下运行，先执行 `build` 脚本，载入 server 文件，最后计时并运行 `start`。

最终分数只有根据计时 (s) 计算的性能分，计算公式： $\operatorname{points} = (1-\operatorname{bound}(\frac{t-5}{25-5}, 0, 1)^{1.5}) \times 100$ （25s 以上零分，5s 以下满分）。若答案错误则零分。

评测资源限制：

- 编译资源限制：8 cores, 16 GB mem, 5 min
- 运行资源限制：8 cores, 16 GB mem, 30 s
- 提交文件包大小：< 20MB

