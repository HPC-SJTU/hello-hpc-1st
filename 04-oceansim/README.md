# Ocean Sim
## 题目背景

小K是一个对海洋充满无限好奇心的小朋友。从小时候第一次在海边看到波浪翻滚、潮汐涨落的那一刻起，他就被这片蔚蓝的世界深深吸引了。每当看到纪录片里那些神秘的海底世界、壮观的洋流和绚丽的珊瑚礁时，小K的眼睛里总是闪着兴奋的光芒。

"要是我也能创造一个属于自己的海洋该多好啊！"小K经常这样想。

这个暑假，小K决定要做一件了不起的事情——用计算机制作一个能够模拟真实海洋的程序！他想要在电脑屏幕上看到海水的温度变化，想要观察海流是如何流动的，想要研究不同深度的海水有什么不同。

凭借着对编程的浓厚兴趣和从网上学来的知识，在AI助手的帮助下，小K终于写出了他人生中第一个海洋模拟器。这个程序可以模拟海洋中的各项物理数值。他把海洋装进自己的电脑里了！

可是当小K满怀期待地运行他的程序时，却遇到了一个大麻烦——程序运行得慢得像乌龟爬行！即使是最简单的模拟，也要等好几个小时才能看到结果。更糟糕的是，当他尝试模拟一个稍微大一点的海洋区域时，光是加载海洋环境就要好久，更别提正式进行模拟了！

"这样下去，我什么时候才能看到我的海洋世界啊！"小K撑着脑袋坐在屏幕前面，抿着嘴，眼巴巴地看着进度条缓慢移动。

就在这时，小K想起了学校里的计算机老师曾经提到过"高性能计算"这个神奇的技术，说它能让程序跑得飞快。"也许，这就是我需要的魔法！"小K兴奋地想到。

"但是要开学了……"，一盆冷水浇在小K的头顶。他为了写出这个程序，暑假作业才刚刚做完一半，而现在还剩7天就要开学了，于是小K决定先完成DDL。至于程序优化，他决定将这个艰巨的任务委托给学习过HPC的你。

## 问题描述

小K凭借着自己的信息素养和热情，用各种网络资料拼凑出了一个可以运行的海洋模拟器，你需要想办法（比如perf）找到这个模拟器的性能瓶颈，对其进行优化，使其尽可能运行得更快。

小K希望你能在优化的同时保持准确性，绝对误差不超过1e-6，相对误差不超过1e-4，你可以使用他提供的验证程序来检查正确性。

## 代码结构

主要代码位于`source_code`目录下：

- `OceanSim.cpp` 未经优化的程序代码

- `verify` 正确性检测程序

- `download.sh` 测试样例下载脚本（需在集群上使用）

`download.sh`使用方法：`bash ./download.sh`。样例将被下载到当前工作目录下，我们建议你直接在source_code目录下运行该脚本。

请勿移动`evaluate.py`的位置，运行时它将自动读取`source_code`文件夹下的内容。

## 编译运行

使用`g++`编译`OceanSim.cpp`

如果你需要运行`verify`，请将参考输出填于第一个参数，将优化后输出填于第二个参数。

## 评分标准

**本题你需要提交优化后的`OceanSim.cpp`文件**。

我们会将你提交的`OceanSim.cpp`替换原有的文件，使用`g++ OceanSim.cpp -o OceanSim -fopenmp -O3 -std=c++20`进行编译，并使用`evaluate.py`依次对评分算例进行测试。

如果你希望测试样例，请运行`python evaluate.py {SAMPLE_ID}`，`SAMPLE_ID`是你想测试的样例（请输入一个数字）。如果你希望测试全部样例，则不用填写这个参数。

你的可执行程序将会运行在比赛集群上的一台机器的**4个核心**上，限制内存占用为**8G**。

| 算例  | 分数占比 | 满分时间(s) | 基础时间(s) |
| --- | ---- | ----| -----|
| 1 | 25% | 0.84 | 8.4 |
| 2 | 25% | 1.6 | 16 |
| 3 | 25% | 2.4 | 24 |
| 4 | 25% | 4.8 | 48 |

题目保证评测算例和下发算例规模一致，请勿自行更改算例文件。

每个算例的分数计算公式为

$$\min(\max( \frac{满分时间*(基础时间-运行时间)}{运行时间*(基础时间-满分时间)},0),1)^2 \times 100$$

**注：直接在集群上用evaluate.py运行未经优化的程序大概率会超时**